<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinapi Secondary Production Dashboard</title>
    <!-- Add Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
       :root {
    --primary-color: #2c3e50;
    --secondary-color: #3B82F6;
    --success-color: #10B981;
    --warning-color: #F59E0B;
    --danger-color: #e74c3c;
    --light-color: #f3f4f6;
    --dark-color: #1e293b;
    --supervisor-luthando: #F9E79F;
    --supervisor-apelele: #e6e6e6; /* Light grey for Apelele */
    --supervisor-siyabonga: #FADBD8;
    --supervisor-nosi: #D6EAF8;
    --supervisor-mvokwe: #D5F5E3;
    --production-color: #e74c3c; /* Red for production */
    --target-color: #10B981; /* Green for target */
    --current-indicator: #F59E0B; /* Yellow for current time indicator */
    --completed-variant: #D1E7DD; /* Light green for completed variants */
    --current-variant: #FFF3CD; /* Light yellow for current variant */
    --upcoming-variant: #F8D7DA; /* Light red for upcoming variants */
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background-color: var(--light-color);
    color: var(--primary-color);
    overflow: auto;
    transition: background-color 0.5s ease;
}

.dashboard-container {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    padding: 12px; /* Reduced padding */
    box-sizing: border-box;
    max-width: 1400px;
    margin: 0 auto;
    transition: background-color 0.5s ease;
}

.fullscreen-mode {
    display: grid;
    grid-template-rows: auto auto auto 1fr auto;
    padding: 8px !important;
    height: 100vh !important;
    width: 100vw !important;
    max-width: 100% !important;
    margin: 0 !important;
    overflow: hidden !important;
    box-sizing: border-box;
    background-color: var(--light-color) !important; /* Add this line */
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px; /* Reduced margin */
    padding-bottom: 5px; /* Reduced padding */
    border-bottom: 1px solid #e2e8f0;
    width: 100%;
}

.supervisor-color-banner {
    width: 100%;
    height: 10px;
    border-radius: 3px;
    margin-bottom: 5px;
}

.title-section {
    display: flex;
    align-items: center;
    gap: 15px; /* Reduced gap */
    flex-wrap: wrap;
}

.title {
    font-size: clamp(1.6rem, 2.4vw, 2.4rem);
    font-weight: bold;
    color: var(--primary-color);
}

.subtitle {
    font-size: clamp(1.2rem, 1.8vw, 1.8rem);
    color: var(--secondary-color);
    font-weight: 500;
}

.date-time {
    text-align: right;
    font-size: clamp(1rem, 1.4vw, 1.4rem);
}

.date {
    font-weight: bold;
}

.time {
    font-size: clamp(1.3rem, 1.8vw, 1.8rem);
    margin-top: 3px; /* Reduced margin */
}

.content {
    display: flex;
    flex-direction: column;
    width: 100%;
    overflow: hidden;
    flex: 1; /* Make sure content takes up available space */
}

/* Supervisor Container - Reduced Height */
.supervisor-container {
    display: flex;
    width: 100%;
    margin-bottom: 5px; /* Reduced from 10px */
    max-height: 120px; /* Add maximum height constraint */
}

.supervisor-bar {
    flex: 0 0 40%;
    border-radius: 8px;
    padding: 6px 10px; /* Reduced padding */
    box-sizing: border-box;
    margin-right: 10px;
    margin-bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.supervisor-name {
    font-size: clamp(1.4rem, 2.4vw, 2.4rem);
    font-weight: bold;
    margin-bottom: 2px; /* Reduced margin */
    color: var(--dark-color);
}

.supervisor-info {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.supervisor-title {
    font-size: clamp(1.2rem, 2vw, 2rem); /* Slightly reduced */
    font-weight: bold;
    color: var(--dark-color);
    margin-bottom: 2px; /* Reduced margin */
}

.product-name {
    font-size: clamp(1.1rem, 1.8vw, 1.8rem); /* Slightly reduced */
    color: var(--dark-color);
}

.variant-sequence-container {
    margin-top: 5px; /* Reduced from 10px */
    width: 100%;
}

.variant-sequence {
    display: flex;
    align-items: center;
    font-size: clamp(0.9rem, 1.4vw, 1.4rem); /* Slightly reduced */
    flex-wrap: wrap;
    gap: 6px; /* Reduced from 8px */
}

.variant-item {
    padding: 4px 10px; /* Reduced padding */
    border-radius: 4px;
    white-space: nowrap;
    position: relative;
    font-weight: 500;
}

.variant-time {
    font-size: clamp(0.7rem, 1.1vw, 1.1rem); /* Slightly reduced */
    display: block;
    text-align: center;
}

.variant-status {
    font-size: clamp(0.7rem, 1.1vw, 1.1rem);
    display: block;
    text-align: center;
    font-weight: bold;
}

.variant-item.completed {
    background-color: var(--completed-variant);
    color: var(--dark-color);
}

.variant-item.current {
    background-color: var(--current-variant);
    color: var(--dark-color);
    font-weight: bold;
}

.variant-item.upcoming {
    background-color: var(--upcoming-variant);
    color: var(--dark-color);
}

.arrow-right {
    margin: 0 4px;
    font-size: clamp(1.2rem, 2vw, 2rem);
    color: var(--dark-color);
}

/* Hourly targets wrapper - Reduced Height */
.hourly-targets-wrapper {
    flex: 0 0 58%;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    padding: 6px; /* Reduced from 10px */
    height: 100%;
    box-sizing: border-box;
    overflow: hidden;
}

.totals-display {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    margin-bottom: 10px;
    font-size: clamp(1rem, 1.3vw, 1.3rem);
    gap: 10px;
    width: 100%;
    box-sizing: border-box;
    align-items: start;
}

.total-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 15px;
    width: 100%;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.total-label {
    font-weight: bold;
    margin-bottom: 4px;
    font-size: clamp(1.1rem, 1.8vw, 1.8rem);
    color: var(--dark-color);
    display: flex;
    align-items: center;
    gap: 8px;
    padding-bottom: 4px;
}

.total-percentage {
    color: var(--warning-color);
    font-size: 1em;
}

.total-value {
    font-size: clamp(1.6rem, 2.4vw, 2.4rem);
    font-weight: bold;
}

.total-subvalue {
    font-size: clamp(1rem, 1.6vw, 1.6rem);
    margin-top: 5px;
}

.current-value {
    color: var(--production-color);
}

.target-value {
    color: var(--target-color);
}

.total-hourly {
    color: var(--dark-color);
}

.chart-container {
    flex: 1; /* Takes all available space */
    background-color: white;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    overflow: hidden;
    width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    min-height: 0; /* Important for flex container */
    margin-top: 5px; /* Added small margin */
}

.charts-row {
    display: flex;
    gap: 10px;
    flex: 1;
    min-height: 0; /* Important for flex container */
    height: calc(80vh - 180px); /* Increased to use space gained from reduced supervisor section */
}

.chart {
    flex: 1;
    background-color: white;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0; /* Important for flex container */
}

.chart-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    flex-wrap: nowrap;
    border-bottom: 1px solid #e2e8f0;
    padding-bottom: 10px;
}

/* Chart title and labels - Enlarged fonts */
.chart-title {
    font-size: clamp(1.5rem, 2.4vw, 2.4rem); /* Increased from 1.3rem */
    font-weight: 600;
    margin-right: 15px;
    color: var(--dark-color);
    white-space: nowrap;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.chart-title-select {
    background: none;
    border: none;
    color: var(--dark-color);
    font-weight: 600;
    font-size: clamp(1.5rem, 2.4vw, 2.4rem); /* Increased from 1.3rem */
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    cursor: pointer;
    padding: 0;
    margin: 0;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    display: inline-block;
}

.chart-title-select:focus {
    outline: none;
}

.chart-title-text {
    font-size: clamp(1.5rem, 2.4vw, 2.4rem); /* Increased from 1.3rem */
    font-weight: 600;
    color: var(--dark-color);
    white-space: nowrap;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.hour-info {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 10px;
    font-weight: 500;
    white-space: nowrap;
    margin-left: 10px;
}

.hour-countdown {
    font-size: clamp(1.2rem, 1.8vw, 1.8rem); /* Increased from 1rem */
    color: var(--secondary-color);
    font-style: normal;
}

.hour-select-container {
    margin-left: auto;
}

.hour-select {
    padding: 6px 12px;
    border-radius: 5px;
    border: 1px solid var(--secondary-color);
    font-family: inherit;
    background-color: white;
    height: 38px; /* Slightly increased */
    font-size: clamp(1.1rem, 1.6vw, 1.6rem); /* Increased from 0.9rem */
    font-weight: 500;
    color: var(--dark-color);
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.chart-area {
    flex: 1;
    position: relative;
    height: 100%;
    min-height: 0;
}

.line-chart, .bar-chart {
    height: 100%;
    width: 100%;
    min-height: 0; /* Important for SVG content */
}

.legend {
    display: flex;
    justify-content: center;
    margin-top: 8px;
    font-size: clamp(1.2rem, 1.8vw, 1.8rem); /* Increased from 1rem */
}

.legend-item {
    display: flex;
    align-items: center;
    margin: 0 12px;
}

.legend-color {
    width: 18px; /* Increased from 15px */
    height: 18px; /* Increased from 15px */
    margin-right: 8px;
    border-radius: 3px;
}

.production-color {
    background-color: var(--production-color);
}

.target-color {
    background-color: var(--target-color);
}

.footer {
    margin-top: 10px;
    text-align: center;
    font-size: clamp(1rem, 1.4vw, 1.4rem);
    color: var(--dark-color);
    width: 100%;
    display: flex;
    justify-content: flex-start;
    align-items: center;
}

.update-info {
    font-size: clamp(0.9rem, 1.4vw, 1.4rem);
    color: var(--dark-color);
    text-align: left;
}

.hourly-targets-container {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    margin-top: 0;
    position: relative;
}

.hourly-targets-svg {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    overflow: visible;
    height: 90px; /* Reduced fixed height */
}

.hourly-circle {
    fill: white;
    stroke: #999;
    stroke-width: 4;
    r: 25; /* Reduced from 40 */
}

.time-label {
    font-size: clamp(0.7rem, 1vw, 1rem); /* Smaller font */
    text-anchor: middle;
    dominant-baseline: hanging;
    fill: #333;
    font-weight: 600;
}

.current-arrow {
    fill: var(--warning-color);
    transform: scale(4.0); /* Reduced from 6.0 */
}

.status-icon {
    stroke-width: 4; /* Thinner lines for smaller circles */
}

.status-success {
    stroke: var(--target-color);
}

.status-fail {
    stroke: var(--production-color);
}

.filter-section {
    display: flex;
    gap: 10px;
    align-items: center;
}

.filter-select {
    padding: 8px 15px;
    border-radius: 5px;
    border: 1px solid var(--secondary-color);
    font-size: clamp(1rem, 1.6vw, 1.6rem);
    font-family: inherit;
    min-width: 180px;
    background-color: white;
}

.loading {
    text-align: center;
    padding: 20px;
    color: var(--dark-color);
    font-size: clamp(1.2rem, 1.8vw, 1.8rem);
}

.error {
    text-align: center;
    padding: 20px;
    color: var(--danger-color);
    font-weight: bold;
    font-size: clamp(1.2rem, 1.8vw, 1.8rem);
}

/* Chart axes labels applied via JS */
.chart-axis-label {
    font-size: 16px; /* Larger font for axis labels */
    font-weight: 500;
    fill: var(--dark-color);
}

.chart-data-label {
    font-size: 18px; /* Larger font for data point values */
    font-weight: 600;
}

/* Chart axis tick labels (the numbers on the axes) */
.chart-tick-label {
    font-size: 14px; /* Larger font for tick labels */
    fill: var(--dark-color);
}

/* Supervisor Selection Button and Modal */
.supervisor-selection-container {
    display: flex;
    align-items: center;
    margin-left: 15px;
}

.supervisor-select-btn {
    background-color: var(--secondary-color);
    color: white;
    padding: 8px 12px;
    font-size: clamp(0.9rem, 1.4vw, 1.4rem);
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 500;
    font-family: inherit;
    transition: background-color 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.supervisor-select-btn:hover {
    background-color: #2563eb;
}

.supervisor-select-btn.secondary {
    background-color: #e2e8f0;
    color: var(--dark-color);
    margin-right: 10px;
}

.supervisor-select-btn.secondary:hover {
    background-color: #cbd5e1;
}

.supervisor-select-btn.primary {
    background-color: var(--success-color);
}

.supervisor-select-btn.primary:hover {
    background-color: #059669;
}

.supervisor-select-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
    animation-name: fadeIn;
    animation-duration: 0.3s;
}

@keyframes fadeIn {
    from {opacity: 0}
    to {opacity: 1}
}

.supervisor-select-content {
    position: relative;
    background-color: #fefefe;
    margin: 10% auto;
    padding: 0;
    border-radius: 8px;
    width: 80%;
    max-width: 600px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    animation-name: slideIn;
    animation-duration: 0.3s;
}

@keyframes slideIn {
    from {top: -300px; opacity: 0}
    to {top: 0; opacity: 1}
}

.supervisor-select-header {
    padding: 15px 20px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.supervisor-select-header h3 {
    margin: 0;
    font-size: 1.5rem;
    color: var(--dark-color);
}

.supervisor-select-close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.supervisor-select-close:hover {
    color: var(--dark-color);
}

.supervisor-select-body {
    padding: 20px;
    max-height: 60vh;
    overflow-y: auto;
}

.supervisor-checkboxes {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.supervisor-checkbox-item {
    display: flex;
    align-items: center;
    padding: 10px;
    border-radius: 6px;
    transition: background-color 0.2s;
}

.supervisor-checkbox-item:hover {
    background-color: #f8fafc;
}

.supervisor-checkbox-item input[type="checkbox"] {
    width: 20px;
    height: 20px;
    margin-right: 15px;
    cursor: pointer;
}

.supervisor-checkbox-item label {
    font-size: 1.2rem;
    font-weight: 500;
    cursor: pointer;
    flex: 1;
}

.supervisor-select-footer {
    padding: 15px 20px;
    border-top: 1px solid #f0f0f0;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/* Color indicators for supervisors */
.supervisor-color-indicator {
    width: 20px;
    height: 20px;
    display: inline-block;
    border-radius: 4px;
    margin-right: 15px;
}

.supervisor-active-badge {
    margin-left: auto;
    background-color: var(--success-color);
    color: white;
    font-size: 0.8rem;
    padding: 3px 8px;
    border-radius: 10px;
}

/* Make button more visible when supervisors are filtered */
.supervisor-select-btn.filtered {
    background-color: var(--warning-color);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
    70% { box-shadow: 0 0 0 5px rgba(245, 158, 11, 0); }
    100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
}

/* Dynamic supervisor color classes */
.dashboard-container.supervisor-luthando .supervisor-color-banner,
.dashboard-container.supervisor-luthando .supervisor-bar {
    background-color: var(--supervisor-luthando);
}

.dashboard-container.supervisor-apelele .supervisor-color-banner,
.dashboard-container.supervisor-apelele .supervisor-bar {
    background-color: var(--supervisor-apelele);
}

.dashboard-container.supervisor-siyabonga .supervisor-color-banner,
.dashboard-container.supervisor-siyabonga .supervisor-bar {
    background-color: var(--supervisor-siyabonga);
}

.dashboard-container.supervisor-nosi .supervisor-color-banner,
.dashboard-container.supervisor-nosi .supervisor-bar {
    background-color: var(--supervisor-nosi);
}

.dashboard-container.supervisor-mvokwe .supervisor-color-banner,
.dashboard-container.supervisor-mvokwe .supervisor-bar {
    background-color: var(--supervisor-mvokwe);
}

/* Responsive design */
@media (max-width: 1200px) {
    .supervisor-container {
        flex-direction: column;
    }
    
    .supervisor-bar {
        flex: 0 0 auto;
        width: 100%;
        margin-right: 0;
        margin-bottom: 10px;
    }
    
    .hourly-targets-wrapper {
        flex: 0 0 auto;
        width: 100%;
    }
    
    .hourly-circle {
        r: 35;
    }
    
    .supervisor-selection-container {
        margin-left: 10px;
    }
}

@media (max-width: 1024px) {
    .charts-row {
        flex-direction: column;
        height: auto;
    }
    
    .chart {
        height: 50vh; /* Increased from 45vh */
        min-height: 350px;
    }
    
    .dashboard-container {
        padding: 8px;
    }
}

@media (max-width: 768px) {
    .header {
        flex-direction: column;
        text-align: center;
    }
    
    .title-section {
        flex-direction: column;
        align-items: center;
        width: 100%;
    }
    
    .filter-section {
        flex-direction: column;
        width: 100%;
        margin-top: 10px;
    }
    
    .filter-select {
        width: 100%;
    }
    
    .date-time {
        text-align: center;
        margin-top: 10px;
    }
    
    .chart {
        height: 40vh;
        min-height: 300px;
    }
    
    .chart-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .hour-select-container {
        margin-left: 0;
        margin-top: 10px;
        width: 100%;
    }
    
    .hour-select {
        width: 100%;
    }
    
    .hourly-circle {
        r: 30;
    }
    
    .status-icon {
        stroke-width: 6;
    }
    
    .supervisor-selection-container {
        margin-top: 10px;
        margin-left: 0;
        width: 100%;
    }
    
    .supervisor-select-btn {
        width: 100%;
    }
    
    .supervisor-select-content {
        width: 95%;
        margin: 5% auto;
    }
}
    </style>
    </head>
<body>
    <div class="dashboard-container">
        <!-- Supervisor color banner -->
        <div class="supervisor-color-banner"></div>
        
        <div class="header">
            <div class="title-section">
                <div>
                    <div class="title">Sinapi Secondary Production Dashboard</div>
                    <div class="subtitle">Medical Device Assembly</div>
                </div>
                <div class="filter-section">
                    <select id="filter-type-select" class="filter-select">
                        <option value="supervisor">Filter by Supervisor</option>
                        <option value="product">Filter by Product</option>
                        <option value="variant">Filter by Variant</option>
                    </select>
                    <select id="filter-value-select" class="filter-select">
                        <option value="all">All</option>
                    </select>
                </div>
            </div>
            <div class="supervisor-selection-container">
    <button id="supervisor-select-btn" class="supervisor-select-btn">
        Select Supervisors
    </button>
    <div id="supervisor-select-modal" class="supervisor-select-modal">
        <div class="supervisor-select-content">
            <div class="supervisor-select-header">
                <h3>Select Supervisors to Display</h3>
                <span class="supervisor-select-close">&times;</span>
            </div>
            <div class="supervisor-select-body">
                <div id="supervisor-checkboxes" class="supervisor-checkboxes">
                    <!-- Checkboxes will be added dynamically -->
                </div>
            </div>
            <div class="supervisor-select-footer">
                <button id="select-all-supervisors" class="supervisor-select-btn secondary">Select All</button>
                <button id="deselect-all-supervisors" class="supervisor-select-btn secondary">Deselect All</button>
                <button id="apply-supervisor-selection" class="supervisor-select-btn primary">Apply Selection</button>
            </div>
        </div>
    </div>
</div>
            <div class="date-time">
    <div class="date" id="current-date">Loading...</div>
    <div class="time" id="current-time">Loading...</div>
    <button class="fullscreen-button" onclick="toggleFullscreen()">Fullscreen</button>
</div>
        </div>

        <div class="content">
            
<!-- Modified Consolidated Supervisor Bar -->
<div class="supervisor-bar">
    <div class="supervisor-info">
        <span class="supervisor-title" id="supervisor-name">SUPERVISOR: Loading...</span>
        <span class="supervisor-title product-name" id="product-name">Product: Loading...</span>
    </div>
    <div class="variant-sequence-container">
        <div class="variant-sequence" id="variant-sequence">
            <div class="loading">Loading variants...</div>
        </div>
    </div>
</div>
            

            <div class="totals-display" id="totals-display">
                <div class="loading">Loading data...</div>
            </div>

            <div class="chart-container">
                <div class="charts-row">
                    <div class="chart">
                        <div class="chart-title" id="cumulative-chart-title">Loading...</div>
                        <div class="chart-area">
                            <div class="line-chart" id="cumulative-chart"></div>
                            <div class="legend">
                                <div class="legend-item">
                                    <div class="legend-color production-color"></div>
                                    <div>Cumulative Production</div>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color target-color"></div>
                                    <div>Cumulative Target</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart">
                        <div class="chart-header">
                            <div class="chart-title-text">
                                <select id="hour-range-select" class="chart-title-select">
                                    <!-- Time slots will be added dynamically -->
                                </select>
                                <span> Production Progress</span>
                            </div>
                            <div class="hour-info" id="hour-info">
                                <div class="hour-countdown"></div>
                            </div>
                        </div>
                        <div class="chart-area">
                            <div class="bar-chart" id="hourly-chart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="update-info" id="last-update2">Last updated: Never</div>
        </div>
    </div>

    <script>
        /**
         * Production Dashboard Application
         */

        // Configuration constants
        const DATA_URL = 'https://opssinapi.github.io/production-dashboard/data.json';
        const UPDATE_INTERVAL = 60 * 1000; // 1 minute update interval
        const CYCLE_INTERVAL = 20000; // 20 seconds cycle interval

        // Application state
        let productionData = { variants: [], supervisors: [] };
        let selectedFilterType = 'supervisor';
        let selectedFilterValue = 'all';
        let selectedHour = 'current';
        let lastUpdateTime = null;
        let isLoading = true;
        let countdownInterval = null;
        let commonChartPadding = { top: 20, right: 30, bottom: 50, left: 70 };
        let isFullscreen = false;
        
        // Variables for product-supervisor grouping
        let productSupervisorGroups = {};
        let currentProduct = null;
        let currentSupervisor = null;
        let currentProductVariants = [];
        let currentVariantKey = null;
        let selectedSupervisors = []; // Array to hold selected supervisors    
        let supervisorFilterActive = false; // Track if supervisor filter is active
        
        // Cycling variables
        let cycleInterval = null;
        let cycleIndex = 0;

        /**
         * Data Module - Handles data fetching, processing, and transformation
         */
        const DataModule = {
            /**
             * Fetches production data from the server
             * @returns {Promise<void>} - A promise that resolves when data is fetched and processed
             */
            async fetchProductionData() {
                try {
                    console.log(`Fetching data from: ${DATA_URL}`);
                    const cacheBuster = '?_=' + new Date().getTime();
                    const response = await fetch(DATA_URL + cacheBuster);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (!data) {
                        throw new Error('Empty data received');
                    }
                    
                    // Transform data format if needed
                    const transformedData = this.transformDataFormat(data);
                    
                    // Only update if the timestamp has changed
                    if (!lastUpdateTime || lastUpdateTime !== transformedData.timestamp) {
                        productionData = transformedData;
                        lastUpdateTime = transformedData.timestamp;
                        
                        // Update the footer timestamp
                        document.getElementById('last-update2').textContent = 'Last updated: ' + transformedData.timestamp;
                        
                        // Process data and update UI
                        this.processProductSupervisorGroups();
                        
                        // Initialize or update UI components
                        if (selectedSupervisors.length === 0) {
                            selectedSupervisors = productionData.supervisors.map(supervisor => supervisor.name);
                        }
                        
                        // Update UI components
                        UIModule.updateFilterValueDropdown();
                        UIModule.updateDashboard();
                    }
                    
                    isLoading = false;
                } catch (error) {
                    console.error('Error fetching data:', error);
                    isLoading = false;
                    UIModule.showError(`Failed to load data: ${error.message}`);
                }
            },
            
            /**
             * Transforms raw data into a consistent format
             * @param {Object} data - The raw data from the server
             * @returns {Object} - Transformed data in a consistent format
             */
            transformDataFormat(data) {
                // Basic transformation logic - this would need to be expanded
                // based on the actual data structure
                return {
                    variants: data.variants || [],
                    supervisors: data.supervisors || [],
                    timestamp: data.timestamp || new Date().toISOString()
                };
            },
            
            /**
             * Processes production data into supervisor-product groups
             */
            processProductSupervisorGroups() {
                // Reset groups
                productSupervisorGroups = {};
                
                // Group variants by supervisor and product
                productionData.supervisors.forEach(supervisor => {
                    if (!supervisor.variants) return;
                    
                    // Group variants by product
                    Object.keys(supervisor.variants).forEach(variantKey => {
                        const product = this.extractProductFromVariant(variantKey);
                        const group = `${supervisor.name}:${product}`;
                        
                        // Initialize group if not exists
                        if (!productSupervisorGroups[group]) {
                            productSupervisorGroups[group] = {
                                supervisor: supervisor.name,
                                product,
                                variants: [],
                                supervisorData: supervisor
                            };
                        }
                        
                        // Find variant data
                        const variantData = productionData.variants.find(v => v.variant === variantKey);
                        
                        if (variantData) {
                            productSupervisorGroups[group].variants.push(variantData);
                        }
                    });
                });
                
                console.log('Product-Supervisor Groups:', productSupervisorGroups);
            },
            
            /**
             * Extracts the product name from a variant identifier
             * @param {string} variantId - The variant identifier string
             * @returns {string} The extracted product name
             */
            extractProductFromVariant(variantId) {
                // For the new structure format with product-variant IDs like "Scalpel-Assembly-PARC11NS"
                if (variantId.includes('-')) {
                    // Try splitting by dash and look for known product patterns
                    const parts = variantId.split('-');
                    
                    // Handle case where product name contains a dash (like Scalpel-Assembly)
                    if (parts.length > 2) {
                        // If we have more than one dash, the product likely contains a dash
                        // Extract everything except the last part (which is the variant)
                        return parts.slice(0, -1).join('-');
                    } else if (parts.length === 2) {
                        // Simple product-variant format
                        return parts[0];
                    }
                }

                // Fallback to original method for older formats
                const parts = variantId.split(' ');
                
                // Handle different formats
                if (parts.length === 1) return variantId; // No space, use as is
                if (parts.length === 2) return parts[0]; // Simple "Product Variant"
                
                // For more complex formats, try to find a pattern
                // Example: "LEVO XL1150SCi" -> "LEVO XL"
                const match = variantId.match(/^([A-Za-z\s]+)[\d]/);
                if (match && match[1]) {
                    return match[1].trim();
                }
                
                // Fallback: use first word
                return parts[0];
            }
        };
        
        /**
         * UI Module - Handles all user interface operations and updates
         */
        const UIModule = {
            /**
             * Updates the dashboard with current data
             */
            updateDashboard() {
                this.updateSupervisorInfo();
                this.updateTotalsDisplay();
                this.updateCharts();
            },
            
            /**
             * Updates the filter value dropdown based on selected filter type
             */
            updateFilterValueDropdown() {
                const select = document.getElementById('filter-value-select');
                if (!select) return;
                
                // Clear existing options
                select.innerHTML = '<option value="all">All</option>';
                
                // Add new options based on selected filter type
                if (selectedFilterType === 'supervisor') {
                    productionData.supervisors.forEach(supervisor => {
                        if (selectedSupervisors.includes(supervisor.name)) {
                            const option = document.createElement('option');
                            option.value = supervisor.name;
                            option.textContent = supervisor.name;
                            select.appendChild(option);
                        }
                    });
                } else if (selectedFilterType === 'product') {
                    // Get unique products
                    const products = new Set();
                    Object.keys(productSupervisorGroups).forEach(key => {
                        if (this.shouldShowGroup(productSupervisorGroups[key])) {
                            products.add(productSupervisorGroups[key].product);
                        }
                    });
                    
                    // Add options
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product;
                        option.textContent = product;
                        select.appendChild(option);
                    });
                } else if (selectedFilterType === 'variant') {
                    // Get unique variants
                    productionData.variants.forEach(variant => {
                        // Check if this variant is under a selected supervisor
                        let isUnderSelectedSupervisor = false;
                        for (const supervisor of productionData.supervisors) {
                            if (selectedSupervisors.includes(supervisor.name) && 
                                supervisor.variants && 
                                supervisor.variants[variant.variant]) {
                                isUnderSelectedSupervisor = true;
                                break;
                            }
                        }
                        
                        if (isUnderSelectedSupervisor) {
                            const option = document.createElement('option');
                            option.value = variant.variant;
                            option.textContent = variant["Product Name"] || variant.variant;
                            select.appendChild(option);
                        }
                    });
                }
                
                // Update UI based on selection
                selectedFilterValue = 'all';
                select.value = 'all';
            },
            
            /**
             * Updates supervisor information in the UI
             */
            updateSupervisorInfo() {
                const supervisorNameEl = document.getElementById('supervisor-name');
                const productNameEl = document.getElementById('product-name');
                const variantSequenceEl = document.getElementById('variant-sequence');
                
                if (!supervisorNameEl || !productNameEl || !variantSequenceEl) return;
                
                if (selectedFilterValue === 'all' || !currentSupervisor || !currentProduct) {
                    // Display default information
                    supervisorNameEl.textContent = 'Select a filter to view production';
                    productNameEl.textContent = '';
                    variantSequenceEl.innerHTML = '';
                    return;
                }
                
                // Update supervisor and product info
                supervisorNameEl.textContent = `SUPERVISOR: ${currentSupervisor}`;
                productNameEl.textContent = `Product: ${currentProduct}`;
                
                // Update variant sequence
                this.updateVariantSequence();
            },
            
            /**
             * Updates the variant sequence display
             */
            updateVariantSequence() {
                // Implementation would go here
            },
            
            /**
             * Updates the totals display with production statistics
             */
            updateTotalsDisplay() {
                // Implementation would go here
            },
            
            /**
             * Updates both charts with current data
             */
            updateCharts() {
                this.updateCumulativeChart();
                this.updateHourlyChart();
            },
            
            /**
             * Updates the cumulative line chart
             */
            updateCumulativeChart() {
                if (!currentProductVariants || currentProductVariants.length === 0) return;
                
                // Calculate cumulative production and targets
                const hours = [];
                const cumulativeProduction = [];
                const cumulativeTargets = [];
                
                let totalProduction = 0;
                let totalTarget = 0;
                
                // Combine data from all variants
                currentProductVariants.forEach(variant => {
                    if (!variant.hourlyProduction || !variant.hourlyTargets) return;
                    
                    variant.hourlyProduction.forEach((prod, index) => {
                        if (!hours.includes(prod.hour)) {
                            hours.push(prod.hour);
                        }
                        
                        const hourIndex = hours.indexOf(prod.hour);
                        
                        // Initialize arrays if needed
                        if (!cumulativeProduction[hourIndex]) cumulativeProduction[hourIndex] = 0;
                        
                        // Add production
                        cumulativeProduction[hourIndex] += (prod.production || 0);
                    });
                    
                    variant.hourlyTargets.forEach((target) => {
                        const hourIndex = hours.indexOf(target.hour);
                        
                        // Initialize arrays if needed
                        if (!cumulativeTargets[hourIndex]) cumulativeTargets[hourIndex] = 0;
                        
                        // Add target
                        cumulativeTargets[hourIndex] += (target.target || 0);
                    });
                });
                
                // Sort hours and reorganize data
                const sortedIndices = hours.map((hour, index) => ({hour, index}))
                    .sort((a, b) => {
                        const [hourA, minuteA] = a.hour.split(':').map(Number);
                        const [hourB, minuteB] = b.hour.split(':').map(Number);
                        return (hourA * 60 + minuteA) - (hourB * 60 + minuteB);
                    })
                    .map(item => item.index);
                
                const sortedHours = sortedIndices.map(i => hours[i]);
                const sortedProduction = sortedIndices.map(i => cumulativeProduction[i] || 0);
                const sortedTargets = sortedIndices.map(i => cumulativeTargets[i] || 0);
                
                // Calculate cumulative values
                const finalCumulativeProduction = [];
                const finalCumulativeTargets = [];
                
                sortedProduction.forEach((prod, i) => {
                    totalProduction += prod;
                    finalCumulativeProduction.push(totalProduction);
                });
                
                sortedTargets.forEach((target, i) => {
                    totalTarget += target;
                    finalCumulativeTargets.push(totalTarget);
                });
                
                // Update chart
                ChartModule.updateCumulativeChart(
                    sortedHours, 
                    finalCumulativeProduction, 
                    finalCumulativeTargets
                );
            },
            
            /**
             * Updates the hourly bar chart
             */
            updateHourlyChart() {
                if (!currentProductVariants || currentProductVariants.length === 0) return;
                
                // Get selected hour range
                const hourRangeSelect = document.getElementById('hour-range-select');
                const selectedRange = hourRangeSelect ? hourRangeSelect.value : 'current';
                
                // Prepare data arrays
                const hours = [];
                const hourlyProduction = [];
                const hourlyTargets = [];
                
                // Combine data from all variants
                currentProductVariants.forEach(variant => {
                    if (!variant.hourlyProduction || !variant.hourlyTargets) return;
                    
                    variant.hourlyProduction.forEach((prod, index) => {
                        if (!hours.includes(prod.hour)) {
                            hours.push(prod.hour);
                        }
                        
                        const hourIndex = hours.indexOf(prod.hour);
                        
                        // Initialize arrays if needed
                        if (!hourlyProduction[hourIndex]) hourlyProduction[hourIndex] = 0;
                        
                        // Add production
                        hourlyProduction[hourIndex] += (prod.production || 0);
                    });
                    
                    variant.hourlyTargets.forEach((target) => {
                        const hourIndex = hours.indexOf(target.hour);
                        
                        // Initialize arrays if needed
                        if (!hourlyTargets[hourIndex]) hourlyTargets[hourIndex] = 0;
                        
                        // Add target
                        hourlyTargets[hourIndex] += (target.target || 0);
                    });
                });
                
                // Sort hours and reorganize data
                const sortedIndices = hours.map((hour, index) => ({hour, index}))
                    .sort((a, b) => {
                        const [hourA, minuteA] = a.hour.split(':').map(Number);
                        const [hourB, minuteB] = b.hour.split(':').map(Number);
                        return (hourA * 60 + minuteA) - (hourB * 60 + minuteB);
                    })
                    .map(item => item.index);
                
                const sortedHours = sortedIndices.map(i => hours[i]);
                const sortedProduction = sortedIndices.map(i => hourlyProduction[i] || 0);
                const sortedTargets = sortedIndices.map(i => hourlyTargets[i] || 0);
                
                // Filter data based on selected range
                let filteredHours = sortedHours;
                let filteredProduction = sortedProduction;
                let filteredTargets = sortedTargets;
                
                if (selectedRange !== 'all') {
                    // Filter to show only the selected hour or current hour
                    const selectedHourIndex = sortedHours.findIndex(hour => hour === selectedRange);
                    
                    if (selectedHourIndex !== -1) {
                        filteredHours = [sortedHours[selectedHourIndex]];
                        filteredProduction = [sortedProduction[selectedHourIndex]];
                        filteredTargets = [sortedTargets[selectedHourIndex]];
                    }
                }
                
                // Update chart
                ChartModule.updateHourlyChart(
                    filteredHours, 
                    filteredProduction, 
                    filteredTargets
                );
            },
            
            /**
             * Determines if a product-supervisor group should be shown based on current filters
             * @param {Object} group - The product-supervisor group
             * @returns {boolean} - Whether the group should be shown
             */
            shouldShowGroup(group) {
                if (!selectedSupervisors.includes(group.supervisor)) {
                    return false;
                }
                
                if (selectedFilterType === 'supervisor' && selectedFilterValue !== 'all') {
                    return group.supervisor === selectedFilterValue;
                } else if (selectedFilterType === 'product' && selectedFilterValue !== 'all') {
                    return group.product === selectedFilterValue;
                } else if (selectedFilterType === 'variant' && selectedFilterValue !== 'all') {
                    // Check if this group contains the selected variant
                    return group.variants.some(v => v.variant === selectedFilterValue);
                }
                
                return true;
            },
            
            /**
             * Displays an error message
             * @param {string} message - The error message to display
             */
            showError(message) {
                const content = document.querySelector('.content');
                if (content) {
                    content.innerHTML = `<div class="error">${message}</div>`;
                }
            },
            
            /**
             * Updates date and time display
             */
            updateDateTime() {
                const now = new Date();
                const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
                
                document.getElementById('current-date').textContent = now.toLocaleDateString(undefined, dateOptions);
                document.getElementById('current-time').textContent = now.toLocaleTimeString(undefined, timeOptions);
            }
        };

        /**
         * Chart Module - Handles all chart rendering and updates
         */
        const ChartModule = {
            // Store chart instances
            cumulativeChart: null,
            hourlyChart: null,
            
            /**
             * Initializes charts
             */
            initCharts() {
                this.setupCumulativeChart();
                this.setupHourlyChart();
            },
            
            /**
             * Sets up the cumulative line chart
             */
            setupCumulativeChart() {
                const ctx = document.getElementById('cumulative-chart');
                if (!ctx) return;
                
                // Destroy existing chart if it exists
                if (this.cumulativeChart) {
                    this.cumulativeChart.destroy();
                }
                
                // Create new chart
                this.cumulativeChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Production',
                                data: [],
                                borderColor: 'var(--production-color)',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                fill: true
                            },
                            {
                                label: 'Target',
                                data: [],
                                borderColor: 'var(--target-color)',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                tension: 0.2,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                titleFont: {
                                    size: 16
                                },
                                bodyFont: {
                                    size: 14
                                },
                                padding: 12,
                                displayColors: true
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    padding: {top: 10, bottom: 0}
                                },
                                ticks: {
                                    font: {
                                        size: 14
                                    }
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Units',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    padding: {top: 0, bottom: 10}
                                },
                                ticks: {
                                    font: {
                                        size: 14
                                    }
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                beginAtZero: true
                            }
                        }
                    }
                });
            },
            
            /**
             * Sets up the hourly bar chart
             */
            setupHourlyChart() {
                const ctx = document.getElementById('hourly-chart');
                if (!ctx) return;
                
                // Destroy existing chart if it exists
                if (this.hourlyChart) {
                    this.hourlyChart.destroy();
                }
                
                // Create new chart
                this.hourlyChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Production',
                                data: [],
                                backgroundColor: 'var(--production-color)',
                                borderColor: 'var(--production-color)',
                                borderWidth: 1
                            },
                            {
                                label: 'Target',
                                data: [],
                                backgroundColor: 'var(--target-color)',
                                borderColor: 'var(--target-color)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                titleFont: {
                                    size: 16
                                },
                                bodyFont: {
                                    size: 14
                                },
                                padding: 12,
                                displayColors: true
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Hour',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    padding: {top: 10, bottom: 0}
                                },
                                ticks: {
                                    font: {
                                        size: 14
                                    }
                                },
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Units',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    padding: {top: 0, bottom: 10}
                                },
                                ticks: {
                                    font: {
                                        size: 14
                                    }
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                beginAtZero: true
                            }
                        }
                    }
                });
            },
            
            /**
             * Updates the cumulative chart with new data
             * @param {Array} hours - Array of hour labels
             * @param {Array} production - Array of production values
             * @param {Array} targets - Array of target values
             */
            updateCumulativeChart(hours, production, targets) {
                if (!this.cumulativeChart) {
                    this.setupCumulativeChart();
                }
                
                if (!this.cumulativeChart) return; // Exit if still not available
                
                // Update chart data
                this.cumulativeChart.data.labels = hours;
                this.cumulativeChart.data.datasets[0].data = production;
                this.cumulativeChart.data.datasets[1].data = targets;
                
                // Update chart
                this.cumulativeChart.update();
                
                // Update title
                const titleElement = document.getElementById('cumulative-chart-title');
                if (titleElement) {
                    if (currentSupervisor && currentProduct) {
                        titleElement.textContent = `${currentProduct} Cumulative Progress`;
                    } else {
                        titleElement.textContent = 'Cumulative Production Progress';
                    }
                }
            },
            
            /**
             * Updates the hourly chart with new data
             * @param {Array} hours - Array of hour labels
             * @param {Array} production - Array of production values
             * @param {Array} targets - Array of target values
             */
            updateHourlyChart(hours, production, targets) {
                if (!this.hourlyChart) {
                    this.setupHourlyChart();
                }
                
                if (!this.hourlyChart) return; // Exit if still not available
                
                // Update chart data
                this.hourlyChart.data.labels = hours;
                this.hourlyChart.data.datasets[0].data = production;
                this.hourlyChart.data.datasets[1].data = targets;
                
                // Update chart
                this.hourlyChart.update();
            }
        };
        
        /**
         * Application initialization and main functions
         */
        
        // Initialize the dashboard on page load
        window.addEventListener('load', initDashboard);
        
        /**
         * Initializes the dashboard application
         */
        function initDashboard() {
            // Initialize UI elements
            UIModule.updateDateTime();
            setInterval(UIModule.updateDateTime, 1000);
            
            // Set up event listeners
            document.getElementById('filter-type-select').addEventListener('change', function() {
                selectedFilterType = this.value;
                UIModule.updateFilterValueDropdown();
            });
            
            document.getElementById('filter-value-select').addEventListener('change', function() {
                selectedFilterValue = this.value;
                UIModule.updateDashboard();
            });
            
            document.getElementById('hour-range-select').addEventListener('change', function() {
                selectedHour = this.value;
                UIModule.updateHourlyChart();
            });
            
            // Set up fullscreen event listeners
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);
            
            // Initialize supervisor selection
            initSupervisorSelection();
            
            // Initialize charts
            ChartModule.initCharts();
            
            // Fetch initial data
            DataModule.fetchProductionData();
            
            // Set up data refresh intervals
            setInterval(() => DataModule.fetchProductionData(), UPDATE_INTERVAL);
        }
        
        /**
         * Handles fullscreen change events
         */
        function handleFullscreenChange() {
            const dashboard = document.querySelector('.dashboard-container');
            const fullscreenButton = document.querySelector('.fullscreen-button');
            
            if (!document.fullscreenElement && 
                !document.mozFullScreenElement && 
                !document.webkitFullscreenElement && 
                !document.msFullscreenElement) {
                dashboard.classList.remove('fullscreen-mode');
                isFullscreen = false;
                fullscreenButton.textContent = 'Fullscreen';
            } else {
                isFullscreen = true;
                fullscreenButton.textContent = 'Exit Fullscreen';
            }
        }
        
        /**
         * Toggles fullscreen mode
         */
        function toggleFullscreen() {
            const dashboard = document.querySelector('.dashboard-container');
            const fullscreenButton = document.querySelector('.fullscreen-button');
            
            if (!document.fullscreenElement && 
                !document.mozFullScreenElement && 
                !document.webkitFullscreenElement && 
                !document.msFullscreenElement) {
                dashboard.classList.add('fullscreen-mode');
                isFullscreen = true;
                fullscreenButton.textContent = 'Exit Fullscreen';
                
                if (dashboard.requestFullscreen) dashboard.requestFullscreen();
                else if (dashboard.msRequestFullscreen) dashboard.msRequestFullscreen();
                else if (dashboard.mozRequestFullScreen) dashboard.mozRequestFullScreen();
                else if (dashboard.webkitRequestFullscreen) dashboard.webkitRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.msExitFullscreen) document.msExitFullscreen();
                else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            }
        }
        
        /**
         * Initializes supervisor selection functionality
         */
        function initSupervisorSelection() {
            const modal = document.getElementById('supervisor-select-modal');
            const btn = document.getElementById('supervisor-select-btn');
            const closeBtn = document.querySelector('.supervisor-select-close');
            const applyBtn = document.getElementById('apply-supervisor-selection');
            const selectAllBtn = document.getElementById('select-all-supervisors');
            const deselectAllBtn = document.getElementById('deselect-all-supervisors');
            
            // Open modal on button click
            btn.addEventListener('click', function() {
                updateSupervisorCheckboxes();
                modal.style.display = 'block';
            });
            
            // Close modal on X click
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Close modal on outside click
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Apply selection
            applyBtn.addEventListener('click', function() {
                applySupervisorSelection();
                modal.style.display = 'none';
            });
            
            // Select all supervisors
            selectAllBtn.addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('#supervisor-checkboxes input[type="checkbox"]');
                checkboxes.forEach(checkbox => checkbox.checked = true);
            });
            
            // Deselect all supervisors
            deselectAllBtn.addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('#supervisor-checkboxes input[type="checkbox"]');
                checkboxes.forEach(checkbox => checkbox.checked = false);
            });
        }
        
        /**
         * Updates supervisor checkboxes in the selection modal
         */
        function updateSupervisorCheckboxes() {
            const container = document.getElementById('supervisor-checkboxes');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Create a checkbox for each supervisor
            productionData.supervisors.forEach(supervisor => {
                const isSelected = selectedSupervisors.includes(supervisor.name);
                
                const item = document.createElement('div');
                item.className = 'supervisor-checkbox-item';
                
                const colorClass = `supervisor-${supervisor.name.toLowerCase()}`;
                const colorStyle = getComputedStyle(document.documentElement).getPropertyValue(`--${colorClass}`) || '#e2e8f0';
                
                const colorIndicator = document.createElement('span');
                colorIndicator.className = 'supervisor-color-indicator';
                colorIndicator.style.backgroundColor = colorStyle;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `supervisor-${supervisor.name}`;
                checkbox.value = supervisor.name;
                checkbox.checked = isSelected;
                
                const label = document.createElement('label');
                label.htmlFor = `supervisor-${supervisor.name}`;
                label.textContent = supervisor.name;
                
                const activeBadge = document.createElement('span');
                activeBadge.className = 'supervisor-active-badge';
                activeBadge.textContent = 'Active';
                activeBadge.style.display = isSelected ? 'inline-block' : 'none';
                
                item.appendChild(colorIndicator);
                item.appendChild(checkbox);
                item.appendChild(label);
                item.appendChild(activeBadge);
                container.appendChild(item);
                
                // Update badge visibility on checkbox change
                checkbox.addEventListener('change', function() {
                    activeBadge.style.display = this.checked ? 'inline-block' : 'none';
                });
            });
        }
        
        /**
         * Applies supervisor selection from checkboxes
         */
        function applySupervisorSelection() {
            const checkboxes = document.querySelectorAll('#supervisor-checkboxes input[type="checkbox"]');
            
            // Update selected supervisors array
            selectedSupervisors = [];
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedSupervisors.push(checkbox.value);
                }
            });
            
            // Save selection to localStorage
            localStorage.setItem('selectedSupervisors', JSON.stringify(selectedSupervisors));
            
            // Update UI
            supervisorFilterActive = selectedSupervisors.length < productionData.supervisors.length;
            const supervisorBtn = document.getElementById('supervisor-select-btn');
            
            if (supervisorBtn) {
                supervisorBtn.classList.toggle('filtered', supervisorFilterActive);
                supervisorBtn.textContent = supervisorFilterActive 
                    ? `Supervisors (${selectedSupervisors.length}/${productionData.supervisors.length})` 
                    : 'Select Supervisors';
            }
            
            // Update filter dropdown and dashboard
            UIModule.updateFilterValueDropdown();
            UIModule.updateDashboard();
        }
        
        /**
         * Loads previously selected supervisors from localStorage
         */
        function loadSelectedSupervisors() {
            const saved = localStorage.getItem('selectedSupervisors');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    if (Array.isArray(parsed)) {
                        selectedSupervisors = parsed;
                        
                        // Ensure all supervisors exist
                        selectedSupervisors = selectedSupervisors.filter(name => 
                            productionData.supervisors.some(s => s.name === name)
                        );
                        
                        // Update UI
                        supervisorFilterActive = selectedSupervisors.length < productionData.supervisors.length;
                        const supervisorBtn = document.getElementById('supervisor-select-btn');
                        
                        if (supervisorBtn) {
                            supervisorBtn.classList.toggle('filtered', supervisorFilterActive);
                            supervisorBtn.textContent = supervisorFilterActive 
                                ? `Supervisors (${selectedSupervisors.length}/${productionData.supervisors.length})` 
                                : 'Select Supervisors';
                        }
                    }
                } catch (e) {
                    console.error('Error loading saved supervisors:', e);
                    selectedSupervisors = productionData.supervisors.map(s => s.name);
                }
            } else {
                selectedSupervisors = productionData.supervisors.map(s => s.name);
            }
        }
    </script>
</body>
</html>